<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’˜ç®€çº¦å¯¼èˆªğŸ’˜</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        /* å…¨å±€é‡ç½® */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: "Microsoft YaHei", "Segoe UI", Arial, sans-serif;
            background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=2070&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: #333;
            min-height: 100vh;
        }

        /* å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¤´éƒ¨ */
        header {
            text-align: center;
            padding-top: 30px;
            padding-bottom: 20px;
        }
        .logo-area {
            display: inline-block;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .logo-icon {
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 10px;
            display: inline-block;
            line-height: 50px;
            font-size: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            vertical-align: middle;
            margin-right: 10px;
            overflow: hidden;
        }
        .logo-icon img { width: 100%; height: 100%; object-fit: cover; }
        .site-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            vertical-align: middle;
        }
        .site-subtitle {
            font-size: 12px;
            color: #666;
            background: rgba(255,255,255,0.6);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }

        /* æœç´¢æ¡† */
        .search-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .search-box {
            position: relative;
            display: flex;
            width: 500px; 
            transition: width 0.3s;
        }
        .search-input {
            width: 100%;
            padding: 10px 15px;
            padding-right: 70px;
            border-radius: 50px;
            border: none;
            outline: none;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.9);
        }
        .search-btn {
            position: absolute;
            right: 4px;
            top: 4px;
            bottom: 4px;
            width: 60px;
            border-radius: 40px;
            border: none;
            background: #409EFF;
            color: #fff;
            cursor: pointer;
            font-size: 13px;
        }

        /* åˆ†ç±»å¡ç‰‡ */
        .category-card {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            position: relative;
        }
        .category-header {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .category-title-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        .category-title {
            font-size: 16px;
            font-weight: bold;
            color: #444;
            display: flex;
            align-items: center;
            cursor: default;
        }
        .category-title i { margin-right: 8px; color: #409EFF; }
        
        .cat-action-btn {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: none;
            margin-left: 5px;
        }
        .btn-rename { background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; }
        .btn-del-cat { background: #fff1f0; color: #f5222d; border: 1px solid #ffa39e; }

        .add-link-btn {
            background: #409EFF;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        /* é“¾æ¥ç½‘æ ¼ */
        .link-grid {
            display: flex;
            flex-wrap: wrap;
            margin: -6px; 
        }
        .link-item {
            width: 20%; 
            padding: 6px;
            overflow: hidden; 
            position: relative;
        }
        .link-card {
            background: rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.8);
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            text-decoration: none;
            display: block;
            transition: all 0.2s;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .link-card:hover {
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            z-index: 2;
        }
        .link-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }
        .link-icon img { width: 100%; height: 100%; object-fit: contain; }
        .link-icon-text { 
            font-size: 28px; 
            line-height: 32px; 
            display: block;
        }
        
        .link-name {
            font-size: 13px;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }
        .link-desc {
            font-size: 11px;
            color: #999;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            line-height: 1.2;
        }

        /* ç¼–è¾‘æŒ‰é’® */
        .link-edit-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: #409EFF;
            color: #fff;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .link-edit-btn:hover { background: #66b1ff; transform: scale(1.1); }

        /* æ·»åŠ æ–°åˆ†æ æŒ‰é’® */
        .add-category-box {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            color: #999;
            cursor: pointer;
            display: none;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.5);
            transition: all 0.2s;
        }
        .add-category-box:hover {
            border-color: #409EFF;
            color: #409EFF;
            background: rgba(255,255,255,0.8);
        }
        .add-category-box i { font-size: 24px; margin-bottom: 10px; display: block; }

        /* åº•éƒ¨ */
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
        }
        .footer-pill {
            display: inline-block;
            background: rgba(255,255,255,0.8);
            padding: 6px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* å³ä¸‹è§’èœå• */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }
        .fab-btn {
            width: 45px;
            height: 45px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #333;
            transition: all 0.3s;
        }
        .fab-btn.active {
            transform: rotate(90deg);
            background: #409EFF;
            color: #fff;
        }
        
        /* èœå• */
        .fab-menu {
            position: absolute;
            bottom: 55px;
            right: 0;
            background: #333;
            color: #fff;
            border-radius: 6px;
            padding: 5px 0;
            width: 140px;
            display: none !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-size: 13px;
            z-index: 101;
        }
        
        .fab-menu.show {
            display: flex !important;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fab-item {
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .fab-item:hover { background: #444; }
        .fab-item i { width: 18px; margin-right: 8px; text-align: center; font-size: 12px; }
        .fab-item.danger { color: #ff6b6b; }

        /* å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            width: 95%;
            max-width: 450px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-title { font-size: 16px; font-weight: bold; margin-bottom: 15px; border-left: 4px solid #409EFF; padding-left: 10px; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        .form-input, .form-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        .btn-group { text-align: right; margin-top: 20px; }
        .btn {
            padding: 6px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            margin-left: 8px;
        }
        .btn-primary { background: #409EFF; color: #fff; }
        .btn-success { background: #67C23A; color: #fff; }
        .btn-danger { background: #F56C6C; color: #fff; }
        .btn-default { background: #f0f0f0; color: #333; }
        
        .range-wrap { display: flex; align-items: center; gap: 10px; }
        .range-wrap input { flex: 1; }
        .range-val { font-size: 12px; color: #409EFF; font-weight: bold; width: 30px; text-align: right;}
        
        /* å£çº¸è®¾ç½®æ ·å¼ */
        .wallpaper-preview {
            width: 100%;
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            background-size: cover;
            background-position: center;
            background-color: #f5f5f5;
        }
        .upload-btn {
            display: inline-block;
            padding: 6px 12px;
            background: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 8px;
        }
        .upload-btn:hover { background: #e0e0e0; }

        @media (max-width: 768px) {
            .link-item { width: 33.33%; }
            .search-box { width: 90% !important; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo-area" onclick="location.reload()">
                <div class="logo-icon" id="headerLogo">ğŸ•</div>
                <span class="site-title" id="siteTitle">ç®€çº¦å¯¼èˆª</span>
                <span class="site-subtitle" id="siteSubtitle">è®©ä¸Šç½‘æ›´ç®€å•</span>
            </div>
            
            <div class="search-wrapper">
                <div class="search-box" id="searchBox">
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢èµ„æº...">
                    <button class="search-btn" onclick="doSearch()">æœç´¢</button>
                </div>
            </div>
        </header>

        <div id="contentArea"></div>

        <!-- æ·»åŠ æ–°åˆ†æ æŒ‰é’® -->
        <div class="add-category-box" id="addCatBox" onclick="addNewCategory()">
            <i class="fa fa-plus-circle"></i>
            <span>ç‚¹å‡»æ·»åŠ æ–°åˆ†æ </span>
        </div>

        <footer>
            <div class="footer-pill" id="footerText">CopyRight Â© ç®€çº¦å¯¼èˆª</div>
        </footer>
    </div>

    <!-- å³ä¸‹è§’èœå• -->
    <div class="fab-container">
        <!-- ç®¡ç†å‘˜èœå• -->
        <div class="fab-menu" id="adminMenu">
            <div class="fab-item" onclick="openSettings()"><i class="fa fa-gear"></i> å…¨å±€è®¾ç½®</div>
            <div class="fab-item" onclick="toggleEditMode()"><i class="fa fa-pencil"></i> <span id="editModeText">ç¼–è¾‘ï¼šå…³</span></div>
            <div class="fab-item danger" onclick="logout()"><i class="fa fa-power-off"></i> é€€å‡º</div>
        </div>
        <!-- æ¸¸å®¢èœå• (ç™»å½•) -->
        <div class="fab-menu" id="guestMenu">
            <div class="fab-item" onclick="openLogin()"><i class="fa fa-sign-in"></i> ç®¡ç†å‘˜ç™»å½•</div>
        </div>
        
        <div class="fab-btn" id="fabBtn" onclick="toggleFabMenu()">
            <i class="fa fa-bars" id="fabIcon"></i>
        </div>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <div class="modal-title">ç®¡ç†å‘˜ç™»å½•</div>
            <div style="background:#fff0f0; color:#f56c6c; padding:8px; font-size:12px; margin-bottom:15px; border-radius:4px;">
                <i class="fa fa-exclamation-circle"></i> æç¤ºï¼šçº¯å‰ç«¯é¡µé¢ä»…ä¾›é˜²è¯¯è§¦ã€‚
            </div>
            <div class="form-group">
                <input type="password" class="form-input" id="passwordInput" placeholder="å¯†ç ">
            </div>
            <div class="btn-group">
                <button class="btn btn-default" onclick="closeModal('loginModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="checkLogin()">è¿›å…¥</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— - æ–°å¢å£çº¸åŠŸèƒ½ -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-title">å…¨å±€è®¾ç½®</div>
            
            <div class="form-group">
                <label class="form-label">æ¯è¡Œæ˜¾ç¤ºæ•°é‡ (åˆ†æ )</label>
                <select class="form-select" id="setLayoutCols">
                    <option value="3">3 åˆ— (å¤§)</option>
                    <option value="4">4 åˆ— (ä¸­)</option>
                    <option value="5">5 åˆ— (æ ‡å‡†)</option>
                    <option value="6">6 åˆ— (ç´§å‡‘)</option>
                    <option value="7">7 åˆ— (å¯†é›†)</option>
                    <option value="8">8 åˆ— (æå®¢)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">å›¾æ ‡å¤§å° (px)</label>
                <div class="range-wrap">
                    <input type="range" id="setIconSize" min="24" max="64" step="4" oninput="document.getElementById('sizeVal').innerText=this.value+'px'">
                    <span id="sizeVal" class="range-val">32px</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">æœç´¢æ¡†å®½åº¦ (px)</label>
                <div class="range-wrap">
                    <input type="range" id="setSearchWidth" min="300" max="800" step="10" oninput="document.getElementById('widthVal').innerText=this.value+'px'">
                    <span id="widthVal" class="range-val">500px</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">æœç´¢æ¡†æç¤ºæ–‡å­—</label>
                <input type="text" class="form-input" id="setSearchPlaceholder" placeholder="ä¾‹å¦‚ï¼šæœç´¢èµ„æºã€è½¯ä»¶...">
            </div>

            <div class="form-group">
                <label class="form-label">ç½‘ç«™æ ‡é¢˜</label>
                <input type="text" class="form-input" id="newSiteTitle">
            </div>
            <div class="form-group">
                <label class="form-label">å‰¯æ ‡é¢˜</label>
                <input type="text" class="form-input" id="newSiteSub">
            </div>
            <div class="form-group">
                <label class="form-label">Logo (Emoji æˆ– URL)</label>
                <input type="text" class="form-input" id="newSiteLogo">
            </div>
            
            <!-- å£çº¸è®¾ç½® -->
            <div class="form-group">
                <label class="form-label">èƒŒæ™¯å£çº¸</label>
                <div id="wallpaperPreview" class="wallpaper-preview"></div>
                <div style="margin-bottom: 8px;">
                    <label class="upload-btn">
                        <i class="fa fa-upload"></i> ä¸Šä¼ æœ¬åœ°å›¾ç‰‡
                        <input type="file" id="wallpaperFile" accept="image/*" style="display:none" onchange="handleWallpaperUpload(this)">
                    </label>
                    <button class="btn btn-default" onclick="clearWallpaper()" style="font-size:12px;">
                        <i class="fa fa-trash"></i> æ¸…é™¤å£çº¸
                    </button>
                </div>
                <input type="text" class="form-input" id="newBgUrl" placeholder="æˆ–è¾“å…¥å›¾ç‰‡URL">
                <p style="font-size:11px; color:#999; margin-top:5px;">
                    <i class="fa fa-info-circle"></i> ä¸Šä¼ æˆ–è®¾ç½®å£çº¸åï¼Œæ‰€æœ‰è®¿é—®è€…éƒ½ä¼šçœ‹åˆ°ç›¸åŒçš„èƒŒæ™¯
                </p>
            </div>
            
            <div class="form-group">
                <label class="form-label">é¡µè„šå†…å®¹</label>
                <input type="text" class="form-input" id="newFooter">
            </div>
            <div class="form-group">
                <label class="form-label">ä¿®æ”¹å¯†ç </label>
                <input type="text" class="form-input" id="newPassword">
            </div>
            
            <div class="form-group" style="background:#f9fafc; padding:10px; border-radius:4px; border:1px solid #eee;">
                <label class="form-label" style="font-weight:bold; margin-bottom:8px; display:block;">æ•°æ®å¤‡ä»½</label>
                <button class="btn btn-default" style="font-size:12px;" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                <label class="btn btn-primary" style="font-size:12px; display:inline-block; cursor:pointer;">
                    å¯¼å…¥æ•°æ®
                    <input type="file" style="display:none;" accept=".json" onchange="importData(this)">
                </label>
            </div>

            <div class="btn-group">
                <button class="btn btn-default" onclick="closeModal('settingsModal')">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="saveSettings()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘é“¾æ¥å¼¹çª— -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <div class="modal-title" id="editModalTitle">ç¼–è¾‘é“¾æ¥</div>
            <input type="hidden" id="editCatIndex">
            <input type="hidden" id="editLinkIndex">
            
            <div class="form-group">
                <label class="form-label">åç§°</label>
                <input type="text" class="form-input" id="editName">
            </div>
            <div class="form-group">
                <label class="form-label">é“¾æ¥åœ°å€ (URL)</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" class="form-input" id="editUrl" onblur="autoFetchMeta()">
                    <button class="btn btn-success" style="padding:6px 10px; white-space:nowrap;" onclick="autoFetchMeta()">
                        <i class="fa fa-magic"></i> è¯†åˆ«
                    </button>
                </div>
                <div style="font-size:11px; color:#666; margin-top:4px;">
                    <i class="fa fa-info-circle"></i> ç‚¹å‡»"è¯†åˆ«"è‡ªåŠ¨è·å–åŸŸåå›¾æ ‡
                </div>
                <div style="margin-top:4px;">
                    <a href="javascript:void(0)" onclick="simulateFileUpload()" style="color:#409EFF; text-decoration:none; font-size:12px;">
                        <i class="fa fa-cloud-upload"></i> ä¸Šä¼ æ–‡ä»¶ä¾›ä¸‹è½½ (è¯´æ˜)
                    </a>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">å¤‡æ³¨è¯´æ˜</label>
                <input type="text" class="form-input" id="editDesc" placeholder="å¦‚ï¼šv1.0 å®˜æ–¹ç‰ˆ">
            </div>
            <div class="form-group">
                <label class="form-label">å›¾æ ‡ (è‡ªåŠ¨è·å–æˆ–æ‰‹åŠ¨)</label>
                <div style="display:flex; gap:5px; align-items:center;">
                    <input type="text" class="form-input" id="editIcon" oninput="updateIconPreview(this.value)">
                    <div id="iconPreview" style="width:32px; height:32px; border:1px solid #ddd; border-radius:4px; display:flex; align-items:center; justify-content:center; font-size:20px; background:#fff; flex-shrink:0;"></div>
                </div>
            </div>

            <div class="btn-group" style="display:flex; justify-content:space-between;">
                <button class="btn btn-danger" onclick="deleteItem()">åˆ é™¤</button>
                <div>
                    <button class="btn btn-default" onclick="closeModal('editModal')">å–æ¶ˆ</button>
                    <button class="btn btn-success" onclick="saveEdit()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- æ•°æ®åˆå§‹åŒ– ---
        var defaultData = {
            password: 'admin',
            footer: 'CopyRight Â© ç®€çº¦å¯¼èˆª',
            bgUrl: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=2070&auto=format&fit=crop', // é»˜è®¤å£çº¸
            siteTitle: 'ç®€çº¦å¯¼èˆª',
            siteSubtitle: 'è®©ä¸Šç½‘æ›´ç®€å•',
            siteLogo: 'ğŸ•',
            layout: {
                cols: 5,
                iconSize: 32
            },
            search: {
                engine: 'https://www.baidu.com/s?wd=',
                placeholder: 'æœç´¢èµ„æºã€è½¯ä»¶ã€æ•™ç¨‹...',
                width: 500
            },
            categories: [
                { 
                    title: 'ğŸš€ å¿…å¤‡è½¯ä»¶', 
                    links: [
                        { name: 'Google Chrome', url: 'https://www.google.cn/chrome/', icon: 'https://www.google.cn/chrome/static/images/chrome-logo-m100.svg', desc: 'å…¨çƒæœ€æµè¡Œæµè§ˆå™¨' },
                        { name: 'Microsoft Edge', url: 'https://www.microsoft.com/zh-cn/edge', icon: 'https://www.microsoft.com/favicon.ico', desc: 'Windowsè‡ªå¸¦' },
                        { name: 'ç™¾åˆ†æµè§ˆå™¨', url: 'https://www.centbrowser.cn/', icon: 'https://www.centbrowser.cn/favicon.ico', desc: 'æé€Ÿå¥½ç”¨' }
                    ]
                },
                { 
                    title: 'ğŸ’¼ åŠå…¬é€šè®¯', 
                    links: [
                        { name: 'å¾®ä¿¡ä¸‹è½½', url: 'https://weixin.qq.com/', icon: 'https://s21.ax1x.com/2025/10/07/pV7yECR.png', desc: 'å®˜æ–¹æ­£å¼ç‰ˆ' },
                        { name: 'é’‰é’‰', url: 'https://www.dingtalk.com/', icon: 'https://s21.ax1x.com/2025/10/07/pV7yiE4.jpg', desc: 'è®©è¿›æ­¥å‘ç”Ÿ' },
                        { name: 'WPS Office', url: 'https://www.wps.cn/', icon: 'https://www.wps.cn/favicon.ico', desc: 'å›½äº§åŠå…¬è½¯ä»¶' },
                        { name: 'å‘æ—¥è‘µè¿œç¨‹', url: 'https://sunlogin.oray.com/', icon: 'https://sunlogin.oray.com/favicon.ico', desc: 'è¿œç¨‹æ§åˆ¶åœ¨æ‰‹å¿ƒ' }
                    ]
                },
                { 
                    title: 'ğŸ’° å•†å®¶ç»è¥', 
                    links: [
                        { name: 'ç¾å›¢å¤–å–å•†å®¶', url: 'https://e.waimai.meituan.com/', icon: 'https://s21.ax1x.com/2025/10/07/pV7yZgx.jpg', desc: 'ç¾å›¢å•†å®¶ç‰ˆ' },
                        { name: 'æ·˜å®é—ªè´­', url: 'https://sell.taobao.com/', icon: 'https://www.taobao.com/favicon.ico', desc: 'æ·˜å®å–å®¶ä¸­å¿ƒ' },
                        { name: 'äº¬ä¸œç§’é€', url: 'https://www.jd.com/', icon: 'https://www.jd.com/favicon.ico', desc: 'äº¬ä¸œå•†å®¶åå°' }
                    ]
                }
            ]
        };

        var appData;
        var isAdmin = false;
        var isEditMode = false;

        // --- åˆå§‹åŒ– ---
        function init() {
            try {
                var stored = localStorage.getItem('navData');
                if (stored) {
                    appData = JSON.parse(stored);
                    if (!appData.layout) appData.layout = { cols: 5, iconSize: 32 };
                    if (!appData.search) appData.search = { engine: 'https://www.baidu.com/s?wd=', placeholder: 'æœç´¢...', width: 500 };
                    if (!appData.bgUrl) appData.bgUrl = defaultData.bgUrl; // å¦‚æœæ²¡æœ‰å£çº¸ï¼Œä½¿ç”¨é»˜è®¤
                } else {
                    appData = JSON.parse(JSON.stringify(defaultData));
                }
            } catch (e) {
                console.log('Storage error', e);
                appData = JSON.parse(JSON.stringify(defaultData));
            }
            render();
        }

        function saveData() {
            try {
                localStorage.setItem('navData', JSON.stringify(appData));
            } catch (e) { alert('ä¿å­˜å¤±è´¥'); }
            render();
        }

        function render() {
            applyLayout();

            document.getElementById('siteTitle').innerText = appData.siteTitle;
            document.getElementById('siteSubtitle').innerText = appData.siteSubtitle;
            document.getElementById('footerText').innerHTML = appData.footer;
            
            var searchInput = document.getElementById('searchInput');
            searchInput.placeholder = appData.search.placeholder || 'æœç´¢...';
            
            var logoEl = document.getElementById('headerLogo');
            if (appData.siteLogo && appData.siteLogo.indexOf('http') === 0) {
                logoEl.innerHTML = '<img src="' + appData.siteLogo + '">';
            } else {
                logoEl.innerText = appData.siteLogo || 'ğŸ';
            }

            // åº”ç”¨å£çº¸
            if (appData.bgUrl) {
                document.body.style.backgroundImage = "url('" + appData.bgUrl + "')";
            }

            // èœå•æ§åˆ¶
            var adminMenu = document.getElementById('adminMenu');
            var guestMenu = document.getElementById('guestMenu');
            
            adminMenu.classList.remove('show');
            guestMenu.classList.remove('show');
            
            if (isAdmin) {
                adminMenu.style.display = 'none';
                guestMenu.style.display = 'none';
            } else {
                adminMenu.style.display = 'none';
                guestMenu.style.display = 'none';
            }

            document.getElementById('editModeText').innerText = isEditMode ? 'ç¼–è¾‘ï¼šå¼€' : 'ç¼–è¾‘ï¼šå…³';
            document.getElementById('editModeText').style.color = isEditMode ? '#67C23A' : '#fff';

            var addCatBox = document.getElementById('addCatBox');
            if (isAdmin && isEditMode) {
                addCatBox.style.display = 'block';
            } else {
                addCatBox.style.display = 'none';
            }

            // æ¸²æŸ“å†…å®¹
            var contentHtml = '';
            for (var i = 0; i < appData.categories.length; i++) {
                var cat = appData.categories[i];
                var catHtml = '<div class="category-card">';
                
                catHtml += '<div class="category-header">';
                catHtml += '<div class="category-title-group">';
                catHtml += '<div class="category-title">' + cat.title + '</div>';
                
                if (isAdmin && isEditMode) {
                    catHtml += '<button class="cat-action-btn btn-rename" style="display:inline-block" onclick="renameCategory(' + i + ')" title="é‡å‘½ååˆ†æ "><i class="fa fa-pencil"></i></button>';
                    catHtml += '<button class="cat-action-btn btn-del-cat" style="display:inline-block" onclick="deleteCategory(' + i + ')" title="åˆ é™¤åˆ†æ "><i class="fa fa-trash"></i></button>';
                }
                catHtml += '</div>'; 

                if (isAdmin && isEditMode) {
                    catHtml += '<button class="add-link-btn" style="display:inline-block;" onclick="addLink(' + i + ')">+ æ·»åŠ é“¾æ¥</button>';
                }
                catHtml += '</div>'; 
                
                catHtml += '<div class="link-grid">';
                for (var j = 0; j < cat.links.length; j++) {
                    var link = cat.links[j];
                    var iconHtml = '';
                    if (link.icon) {
                        if (link.icon.indexOf('http') === 0) {
                            iconHtml = '<img src="' + link.icon + '" alt="icon">';
                        } else {
                            iconHtml = '<span class="link-icon-text">' + link.icon + '</span>';
                        }
                    } else {
                        iconHtml = '<span class="link-icon-text" style="color:#ccc;"><i class="fa fa-link"></i></span>';
                    }

                    var editBtnHtml = '';
                    if (isAdmin && isEditMode) {
                        editBtnHtml = '<div class="link-edit-btn" style="display:flex" onclick="event.stopPropagation(); event.preventDefault(); openEditLink(' + i + ', ' + j + ')" title="ç¼–è¾‘"><i class="fa fa-pencil"></i></div>';
                    }

                    catHtml += '<div class="link-item">';
                    catHtml += '<a href="' + link.url + '" target="_blank" class="link-card">';
                    catHtml += editBtnHtml;
                    catHtml += '<div class="link-icon">' + iconHtml + '</div>';
                    catHtml += '<span class="link-name">' + link.name + '</span>';
                    if (link.desc) catHtml += '<span class="link-desc">' + link.desc + '</span>';
                    catHtml += '</a>';
                    catHtml += '</div>';
                }
                catHtml += '</div></div>';
                contentHtml += catHtml;
            }
            document.getElementById('contentArea').innerHTML = contentHtml;
        }

        function applyLayout() {
            var cols = appData.layout.cols || 5;
            var size = appData.layout.iconSize || 32;
            var searchWidth = appData.search.width || 500;

            var items = document.getElementsByClassName('link-item');
            for (var i = 0; i < items.length; i++) {
                items[i].style.width = (100 / cols) + '%';
            }
            
            var icons = document.getElementsByClassName('link-icon');
            for (var i = 0; i < icons.length; i++) {
                icons[i].style.width = size + 'px';
                icons[i].style.height = size + 'px';
                var textIcon = icons[i].querySelector('.link-icon-text');
                if (textIcon) {
                    textIcon.style.lineHeight = size + 'px';
                    textIcon.style.fontSize = (size * 0.9) + 'px';
                }
            }

            document.getElementById('searchBox').style.width = searchWidth + 'px';
        }

        // --- å£çº¸å¤„ç†å‡½æ•° ---
        function handleWallpaperUpload(input) {
            var file = input.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                var base64 = e.target.result;
                document.getElementById('wallpaperPreview').style.backgroundImage = 'url(' + base64 + ')';
                document.getElementById('newBgUrl').value = base64;
            };
            reader.readAsDataURL(file);
        }
        
        function clearWallpaper() {
            document.getElementById('wallpaperPreview').style.backgroundImage = 'none';
            document.getElementById('newBgUrl').value = '';
        }

        // --- èœå•åˆ‡æ¢ ---
        function toggleFabMenu() {
            var adminMenu = document.getElementById('adminMenu');
            var guestMenu = document.getElementById('guestMenu');
            var fabBtn = document.getElementById('fabBtn');
            var fabIcon = document.getElementById('fabIcon');
            
            var currentMenu = isAdmin ? adminMenu : guestMenu;
            
            if (currentMenu.classList.contains('show')) {
                currentMenu.classList.remove('show');
                fabBtn.classList.remove('active');
                fabIcon.className = 'fa fa-bars';
            } else {
                currentMenu.classList.add('show');
                fabBtn.classList.add('active');
                fabIcon.className = 'fa fa-times';
            }
        }

        // --- äº¤äº’ ---
        function doSearch() {
            var val = document.getElementById('searchInput').value;
            if (val) {
                var engine = appData.search.engine;
                window.open(engine + encodeURIComponent(val), '_blank');
            }
        }
        document.getElementById('searchInput').onkeypress = function(e) {
            if ((e || window.event).keyCode === 13) doSearch();
        };

        function openLogin() {
            closeFabMenu();
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('passwordInput').focus();
        }
        function checkLogin() {
            if (document.getElementById('passwordInput').value === appData.password) {
                isAdmin = true;
                closeModal('loginModal');
                document.getElementById('passwordInput').value = '';
                closeFabMenu();
                render();
            } else { alert('å¯†ç é”™è¯¯'); }
        }
        function logout() {
            isAdmin = false;
            isEditMode = false;
            closeFabMenu();
            render();
        }
        
        function closeFabMenu() {
            var adminMenu = document.getElementById('adminMenu');
            var guestMenu = document.getElementById('guestMenu');
            var fabBtn = document.getElementById('fabBtn');
            var fabIcon = document.getElementById('fabIcon');
            
            adminMenu.classList.remove('show');
            guestMenu.classList.remove('show');
            fabBtn.classList.remove('active');
            fabIcon.className = 'fa fa-bars';
        }
        
        function toggleEditMode() {
            if (!isAdmin) return;
            isEditMode = !isEditMode;
            closeFabMenu();
            setTimeout(function() { render(); }, 50);
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- æ™ºèƒ½è¯†åˆ«å›¾æ ‡ ---
        function autoFetchMeta() {
            var urlInput = document.getElementById('editUrl');
            var iconInput = document.getElementById('editIcon');
            var nameInput = document.getElementById('editName');
            var url = urlInput.value;

            if (!url) return;
            if (url.indexOf('http') !== 0) url = 'https://' + url;
            
            try {
                var a = document.createElement('a');
                a.href = url;
                var hostname = a.hostname;
                var protocol = a.protocol;
                
                var faviconUrl = protocol + '//' + hostname + '/favicon.ico';
                
                iconInput.value = faviconUrl;
                updateIconPreview(faviconUrl);

                if (!nameInput.value) {
                    var cleanName = hostname.replace('www.', '').split('.')[0];
                    cleanName = cleanName.charAt(0).toUpperCase() + cleanName.slice(1);
                    nameInput.value = cleanName;
                }
            } catch (e) {
                console.log('URL parse error', e);
            }
        }

        function simulateFileUpload() {
            alert('æç¤ºï¼šé™æ€ç½‘é¡µæ— æ³•å­˜å‚¨æ–‡ä»¶ã€‚\nè¯·å°†æ–‡ä»¶ä¸Šä¼ è‡³ç½‘ç›˜ï¼Œå¤åˆ¶é“¾æ¥å¡«å…¥"é“¾æ¥åœ°å€"æ ï¼Œåç§°å¡«æ–‡ä»¶åï¼Œå¤‡æ³¨å¡«æå–ç ã€‚');
        }

        // --- ç¼–è¾‘é“¾æ¥é€»è¾‘ ---
        function openEditLink(catIndex, linkIndex) {
            if (!isAdmin || !isEditMode) return;

            document.getElementById('editCatIndex').value = catIndex;
            document.getElementById('editLinkIndex').value = linkIndex;
            document.getElementById('editModalTitle').innerText = 'ç¼–è¾‘é“¾æ¥';
            var link = appData.categories[catIndex].links[linkIndex];
            document.getElementById('editName').value = link.name;
            document.getElementById('editUrl').value = link.url;
            document.getElementById('editDesc').value = link.desc || '';
            document.getElementById('editIcon').value = link.icon || '';
            updateIconPreview(link.icon);
            document.getElementById('editModal').style.display = 'flex';
        }
        function addLink(catIndex) {
            document.getElementById('editCatIndex').value = catIndex;
            document.getElementById('editLinkIndex').value = -1;
            document.getElementById('editModalTitle').innerText = 'æ·»åŠ é“¾æ¥';
            document.getElementById('editName').value = '';
            document.getElementById('editUrl').value = '';
            document.getElementById('editDesc').value = '';
            document.getElementById('editIcon').value = '';
            updateIconPreview('');
            document.getElementById('editModal').style.display = 'flex';
        }
        function saveEdit() {
            var catIdx = parseInt(document.getElementById('editCatIndex').value);
            var linkIdx = parseInt(document.getElementById('editLinkIndex').value);
            var name = document.getElementById('editName').value;
            var icon = document.getElementById('editIcon').value;
            if (!name) { alert('åç§°ä¸èƒ½ä¸ºç©º'); return; }
            var url = document.getElementById('editUrl').value;
            var desc = document.getElementById('editDesc').value;
            if (!url) { alert('é“¾æ¥ä¸èƒ½ä¸ºç©º'); return; }

            if (linkIdx === -1) {
                appData.categories[catIdx].links.push({ name: name, url: url, icon: icon, desc: desc });
            } else {
                appData.categories[catIdx].links[linkIdx] = { name: name, url: url, icon: icon, desc: desc };
            }
            saveData();
            closeModal('editModal');
        }
        function deleteItem() {
            if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
            var catIdx = parseInt(document.getElementById('editCatIndex').value);
            var linkIdx = parseInt(document.getElementById('editLinkIndex').value);
            appData.categories[catIdx].links.splice(linkIdx, 1);
            saveData();
            closeModal('editModal');
        }
        function updateIconPreview(val) {
            var preview = document.getElementById('iconPreview');
            if (!val) { preview.innerHTML = ''; preview.style.background = '#fff'; }
            else if (val.indexOf('http') === 0) { 
                preview.innerHTML = '<img src="' + val + '" style="width:100%; height:100%;">'; 
                preview.style.background = 'white';
            } else { 
                preview.innerHTML = val; 
                preview.style.background = '#f9fafb';
            }
        }

        // --- åˆ†æ ç®¡ç†åŠŸèƒ½ ---
        function addNewCategory() {
            var name = prompt("è¯·è¾“å…¥æ–°åˆ†æ çš„åç§°ï¼ˆæ”¯æŒ Emojiï¼Œä¾‹å¦‚ï¼šğŸ® æ¸¸æˆå¨±ä¹ï¼‰ï¼š");
            if (name) {
                appData.categories.push({
                    title: name,
                    links: []
                });
                saveData();
                setTimeout(function() {
                    window.scrollTo(0, document.body.scrollHeight);
                }, 100);
            }
        }

        function renameCategory(index) {
            var newName = prompt("ä¿®æ”¹åˆ†æ åç§°ï¼š", appData.categories[index].title);
            if (newName) {
                appData.categories[index].title = newName;
                saveData();
            }
        }

        function deleteCategory(index) {
            if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†æ å—ï¼Ÿé‡Œé¢çš„é“¾æ¥ä¹Ÿä¼šè¢«ä¸€èµ·åˆ é™¤ï¼")) {
                appData.categories.splice(index, 1);
                saveData();
            }
        }

        // --- è®¾ç½®é€»è¾‘ ---
        function openSettings() {
            if (!isAdmin) return;
            closeFabMenu();
            
            document.getElementById('newSiteTitle').value = appData.siteTitle;
            document.getElementById('newSiteSub').value = appData.siteSubtitle;
            document.getElementById('newSiteLogo').value = appData.siteLogo || '';
            document.getElementById('newFooter').value = appData.footer;
            document.getElementById('newPassword').value = appData.password;
            document.getElementById('newBgUrl').value = appData.bgUrl || '';
            
            // æ˜¾ç¤ºå£çº¸é¢„è§ˆ
            if (appData.bgUrl) {
                document.getElementById('wallpaperPreview').style.backgroundImage = 'url(' + appData.bgUrl + ')';
            } else {
                document.getElementById('wallpaperPreview').style.backgroundImage = 'none';
            }
            
            document.getElementById('setLayoutCols').value = appData.layout.cols;
            document.getElementById('setIconSize').value = appData.layout.iconSize;
            document.getElementById('sizeVal').innerText = appData.layout.iconSize + 'px';

            document.getElementById('setSearchWidth').value = appData.search.width;
            document.getElementById('widthVal').innerText = appData.search.width + 'px';
            document.getElementById('setSearchPlaceholder').value = appData.search.placeholder;

            document.getElementById('settingsModal').style.display = 'flex';
        }
        function saveSettings() {
            appData.siteTitle = document.getElementById('newSiteTitle').value;
            appData.siteSubtitle = document.getElementById('newSiteSub').value;
            appData.siteLogo = document.getElementById('newSiteLogo').value;
            appData.footer = document.getElementById('newFooter').value;
            appData.password = document.getElementById('newPassword').value;
            
            var bgUrl = document.getElementById('newBgUrl').value;
            if (bgUrl) {
                appData.bgUrl = bgUrl;
            }
            
            appData.layout.cols = parseInt(document.getElementById('setLayoutCols').value);
            appData.layout.iconSize = parseInt(document.getElementById('setIconSize').value);
            
            appData.search.width = parseInt(document.getElementById('setSearchWidth').value);
            appData.search.placeholder = document.getElementById('setSearchPlaceholder').value;

            saveData();
            closeModal('settingsModal');
            alert('è®¾ç½®å·²ä¿å­˜ï¼å£çº¸æ›´æ¢åï¼Œæ‰€æœ‰è®¿é—®è€…éƒ½ä¼šçœ‹åˆ°æ–°èƒŒæ™¯ã€‚');
        }

        // --- å¯¼å…¥å¯¼å‡º ---
        function exportData() {
            var dataStr = JSON.stringify(appData, null, 2);
            if (window.navigator.msSaveBlob) {
                var blob = new Blob([dataStr], { type: "application/json" });
                window.navigator.msSaveBlob(blob, "nav-backup.json");
            } else {
                var blob = new Blob([dataStr], { type: "application/json" });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url; a.download = "nav-backup.json";
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            }
        }
        function importData(input) {
            var file = input.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var data = JSON.parse(e.target.result);
                    if (data.categories && confirm('ç¡®å®šå¯¼å…¥ï¼Ÿå°†è¦†ç›–å½“å‰æ•°æ®ã€‚')) {
                        appData = data;
                        if (!appData.layout) appData.layout = { cols: 5, iconSize: 32 };
                        if (!appData.search) appData.search = { width: 500, placeholder: 'æœç´¢...' };
                        if (!appData.bgUrl) appData.bgUrl = defaultData.bgUrl;
                        saveData();
                        location.reload();
                    }
                } catch (err) { alert('æ–‡ä»¶é”™è¯¯'); }
            };
            reader.readAsText(file);
            input.value = '';
        }

        init();
    </script>
</body>
</html>
